<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LinkBotLabs Products + Affiliate</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 16px;
    background: linear-gradient(180deg, #000, #1a1a1a);
    color: #fff;
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  h1 { text-align: center; color: cyan; margin: 10px 0; }

  .affiliate-banner {
    background: #0077b6;
    color: #fff;
    padding: 12px;
    text-align: center;
    font-weight: bold;
    display: none;
  }

  #main { flex: 1; display: flex; flex-direction: column; }
  .top-half, .bottom-half { flex: 1; }

  /* --- Product Carousel --- */
  .top-half {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
  }
  .product-card {
    flex: 0 0 100%;
    scroll-snap-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    background: rgba(26, 26, 46, 0.85);
    border: 1px solid #3a3a5d;
    padding: 20px;
    text-align: center;
    backdrop-filter: blur(6px);
  }
  .product-title { font-size: 28px; font-weight: bold; margin: 15px 0; }
  .product-price { color: cyan; font-weight: bold; font-size: 22px; }
  .product-desc { font-size: 18px; color: #ccc; margin: 20px 0; }
  .product-btn {
    padding: 18px;
    background: black;
    border: 2px solid cyan;
    border-radius: 10px;
    color: white;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    width: 80%;
    margin: 0 auto;
    transition: 0.2s;
  }
  .product-btn:hover { background: cyan; color: black; }

  /* --- Bottom Section --- */
  .bottom-half {
    display: flex;
    flex-direction: row;
    border-top: 2px solid #3a3a5d;
    background: rgba(15, 15, 25, 0.9);
    padding: 12px;
    gap: 16px;
  }

  /* --- Chat Section --- */
  .chat-section {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  #chat-feed {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    font-size: 26px;
    line-height: 1.6;
    border-radius: 10px;
    border: 1px solid #3a3a5d;
    background: #111;
    margin-bottom: 12px;
  }
  .msg { margin: 8px 0; }
  .user { color: cyan; font-weight: bold; }
  .ai { color: #fff; }

  .chat-input {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  #chatText {
    flex: 1;
    font-size: 24px;
    padding: 16px;
    height: 100px; /* larger input */
    border-radius: 8px;
    border: 1px solid #3a3a5d;
    background: #111;
    color: #fff;
    resize: none;
  }
  #chatText:focus {
    outline: none;
    border: 2px solid cyan;
    box-shadow: 0 0 10px cyan;
  }
  .round-btn {
    width: 60px; height: 60px;
    border-radius: 50%;
    border: 2px solid cyan;
    background: black; color: white;
    font-size: 24px; cursor: pointer;
    transition: 0.2s;
  }
  .round-btn:hover { transform: scale(1.1); background: cyan; color: black; }

  /* --- Affiliate Onboarding --- */
  .affiliate-section {
    flex: 1;
    background: rgba(10,10,40,0.6);
    border-radius: 12px;
    padding: 16px;
    border: 1px solid rgba(0,255,255,0.3);
    overflow-y: auto;
  }
  .affiliate-section h2 { color: cyan; margin-bottom: 10px; }
  input, button {
    width: 100%;
    padding: 12px;
    margin: 6px 0;
    border-radius: 8px;
    border: none;
    font-size: 1rem;
  }
  input { background: rgba(15,15,50,0.7); color: #fff; }
  button {
    background: linear-gradient(135deg,#00ffff,#00bfff);
    color:#0b0c22; font-weight:bold; cursor:pointer; transition:0.3s;
  }
  button:hover { opacity:0.85; }
  .output { margin-top: 8px; color: #00ffea; }
</style>
</head>
<body>
<div id="affiliate-banner" class="affiliate-banner"></div>
<h1>‚ú® LinkBotLabs Product Picks ‚ú®</h1>

<div id="main">
  <div class="top-half" id="content"></div>
  <div class="bottom-half">
    
    <!-- Chat Section -->
    <div class="chat-section">
      <div id="chat-feed"></div>
      <div class="chat-input">
        <textarea id="chatText" placeholder="Type your message..."></textarea>
        <button id="runGlobal" class="round-btn">‚ñ∂</button>
        <button id="speakGlobal" class="round-btn">üé§</button>
        <button id="clearGlobal" class="round-btn">‚ùå</button>
        <button id="ttsGlobal" class="round-btn">üîä</button>
      </div>
    </div>
    
    <!-- Affiliate Section -->
    <div class="affiliate-section">
      <h2>üöÄ Join the Affiliate Program</h2>
      <p>Join by <strong>buying 1 product</strong> OR <strong>contributing</strong> via Wise.</p>
      <a href="https://wise.com/pay/me/davids14542" target="_blank">
        <button>üí∏ Contribute via Wise</button>
      </a>
      <p>After contribution or purchase, register your affiliate tag below:</p>
      <form id="affiliateForm">
        <input type="text" id="userAffiliate" placeholder="Enter your tag (mytag-20)" required>
        <button type="submit">Activate Affiliate Tag</button>
      </form>
      <div id="regOutput" class="output"></div>
    </div>
    
  </div>
</div>

<script src="https://js.puter.com/v2/"></script>
<script>
const content = document.getElementById("content");
const chatFeed = document.getElementById("chat-feed");
const chatText = document.getElementById("chatText");

let synth = window.speechSynthesis;
let utter;

// Load affiliate tag
function getAffiliateId() {
  const params = new URLSearchParams(window.location.search);
  return params.get("aff_id") || null;
}
let userAffiliateTag = localStorage.getItem('affiliateTag') || getAffiliateId() || "";

function updateBanner() {
  const banner = document.getElementById("affiliate-banner");
  if(userAffiliateTag){
    banner.textContent = `‚úÖ Active Affiliate: ${userAffiliateTag}`;
    banner.style.display = "block";
  } else {
    banner.textContent = "‚ÑπÔ∏è No affiliate tag set. Register yours below!";
    banner.style.display = "block";
  }
}
updateBanner();

// Load products
async function loadProducts() {
  try {
    const res = await fetch("products.json?cachebust=" + Date.now());
    const data = await res.json();
    renderProducts(data);
  } catch {
    content.innerHTML = `<p style="color:red;">‚ùå Failed to load products.</p>`;
  }
}
function renderProducts(data) {
  content.innerHTML = "";
  for (const [category, items] of Object.entries(data)) {
    items.forEach(p => {
      const card = document.createElement("div");
      card.className = "product-card";
      card.innerHTML = `
        <h3 class="product-title">${p.title}</h3>
        <p class="product-price">${p.price}</p>
        <p class="product-desc">${p.description}</p>
        <button class="product-btn">üõí View</button>
      `;
      card.querySelector("button").onclick = () => {
        let link = p.url;
        if (userAffiliateTag) link += (p.url.includes("?") ? "&" : "?") + "tag=" + userAffiliateTag;
        window.open(link, "_blank");
      };
      content.appendChild(card);
    });
  }
}
loadProducts();

// Chat functions
function appendMessage(text, sender="ai") {
  const div = document.createElement("div");
  div.className = "msg " + sender;
  div.textContent = sender === "user" ? `üßë: ${text}` : `ü§ñ: ${text}`;
  chatFeed.appendChild(div);
  chatFeed.scrollTop = chatFeed.scrollHeight;
}

document.getElementById("runGlobal").onclick = async () => {
  const userText = chatText.value.trim();
  if (!userText) return;
  appendMessage(userText, "user");
  chatText.value = "";
  const response = await puter.ai.chat(userText);
  appendMessage(response, "ai");
  playTTS(response);
};
document.getElementById("ttsGlobal").onclick = () => playTTS(chatFeed.innerText);
document.getElementById("clearGlobal").onclick = () => chatFeed.innerHTML = "";
document.getElementById("speakGlobal").onclick = () => alert("üé§ Voice input coming soon!");

// TTS
function playTTS(text) {
  if (synth.speaking) synth.cancel();
  utter = new SpeechSynthesisUtterance(text);
  synth.speak(utter);
}

// Affiliate form
document.getElementById("affiliateForm").addEventListener("submit", function(e){
  e.preventDefault();
  const tag = document.getElementById("userAffiliate").value.trim();
  if(tag){
    userAffiliateTag = tag;
    localStorage.setItem('affiliateTag', tag);
    document.getElementById("regOutput").innerText = `‚úÖ Tag "${tag}" saved!`;
    updateBanner();
  } else {
    document.getElementById("regOutput").innerText = "‚ùå Enter a valid affiliate tag.";
  }
});
</script>
</body>
</html>
